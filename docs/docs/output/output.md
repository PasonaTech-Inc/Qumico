# 出力ファイル

- Qumicoが生成するソースコードは、out_c/フォルダに出力されます。  
  out_c/フォルダには、下記のフォルダやファイルが格納されます。

- include/ フォルダ
- lib/ フォルダ
- initializers/ フォルダ (必要に応じて作成)
- qumico.c
- numpy.c  (必要に応じて作成)
- qumico.so

## include/ フォルダ

次のファイルが格納されます。

- qumico_type.h  : qumicoで使用する、データタイプ等を定義します。
- qumico.h       : qumicoで使用するリテラル等を定義します。
- numpy.h        : numpy.cを使用する場合、その関数を定義します。

## lib/ フォルダ

DLモデルの各レイヤーで必要なオペレーション種別ごとに、処理関数のソースコードを格納します。  
各ファイルには、

- オペレーションのパラメータを示す構造体
- レイヤーごとの処理関数
が記載されます。

各処理関数は、次のように定義します。

- 関数名: "Op"+オペレーション種別+連番 (例: OpConv1)
- 引数:
    - オペレーションのパラメータ構造体(void *op_param)
    - 入力データ、重みデータ、バイアスデータ 等 
    - 出力データ 等
    - 入力パラメータ: 将来の拡張用(void *input_params)
    - 出力パラメータ: 将来の拡張用(void *output_params)
- 戻り値
 なし

オペレータの引数については、ONNXのオペレータ仕様を参照してください。  [Operator Schemas](https://github.com/onnx/onnx/blob/master/docs/Operators.md)

## initializers/ フォルダ

DLモデルの重みデータを格納します。  
ファイル名は、vi_<レイヤー種類>\_<レイヤー番号>\_<その他>.npy  
データ形式はndarray形式で格納します。

## qumico.c

**qumico.c**はQumicoが出力するソースコードの主要部分になります。

### include Library

Qumico専用ライブラリ含めて、変換に必要なヘッダファイルやライブラリをincludeします。
    - include/qumico.h
    - include/qumico_type.h

### 初期値定義

ONNXでinitializersとして定義されている重みデータ等について、メモリ確保と宣言を行います。

### ノード定義

次の定義を行います。

- 使用するレイヤー数
- 各レイヤーのパラメータ構造体
- 各入出力ノードのtensorのディメンジョン
- 各入出力ノードの定義とメモリ確保

### void init()

- 各ノードに対応する変数と、パラメータの設定を行います。
- 戻り値　なし

### load_initializers()

DLモデルの重みデータのロードを行います。

- 引数:
 const char *path: 重みデータファイルのパス設定(将来の拡張用)
- 戻り値:  
 0: 正常終了  
 非0: 異常終了

### int run()

DLモデルの演算実行を行います。

- 引数：
 第1引数 DLモデルの入力データを与えます。
 第2引数 DLモデルの出力データの格納先を与えます。
- 戻り値
 0


### int qumico()

DLモデルの初期化および演算実行を順番に実行して、DL推論処理を行います。

- 引数：
 第1引数 DLモデルの入力データを与えます。
 第2引数 DLモデルの出力データの格納先を与えます。
- 戻り値
 0


## numpy.c

DLモデルの重みデータとして、ndarray形式のバイナリデータを使用する場合に作成されます。
ndarray形式のデータを扱う関数を記載しています。


## qumico.so

上記、一連のソースコードをコンパイルおよびリンクした結果をDLLとして出力しています。

